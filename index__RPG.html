<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<title>Pixel RPG Stable</title>
<style>
body{margin:0;background:#000;color:#fff;font-family:monospace}
canvas{display:block;margin:0 auto;background:#111;image-rendering:pixelated}
#ui{position:fixed;left:10px;top:10px}
#hint{position:fixed;bottom:10px;width:100%;text-align:center}
</style>
</head>
<body>

<canvas id="game" width="960" height="540"></canvas>

<div id="ui">
HP:<span id="hp"></span>
MP:<span id="mp"></span><br>
ATK:<span id="atk"></span>
Gold:<span id="gold"></span>
</div>

<div id="hint">WASD移動｜Space攻擊｜1~3技能｜E互動｜Z包包</div>

<script>
const c=game,ctx=c.getContext("2d");
let keys={};

const player={
 x:460,y:300,w:20,h:28,
 hp:100,maxHp:100,
 mp:50,maxMp:50,
 atk:6,speed:2
};
let gold=20;

/* ===== 建築物 ===== */
const buildings=[
 {x:200,y:200,w:120,h:90,name:"商店",type:"shop"},
 {x:380,y:180,w:160,h:110,name:"公會",type:"guild"}
];

/* ===== 怪物 ===== */
let enemies=[
 {name:"史萊姆",lv:1,x:600,y:320,hp:30,maxHp:30,atk:2}
];

/* ===== 技能 ===== */
const skills={
 1:{mp:5,dmg:20,color:"#f60"},
 2:{mp:8,dmg:30,color:"#6cf"},
 3:{mp:10,dmg:40,color:"#fcf"}
};

/* ===== 更新 ===== */
function update(){
 if(keys.w)player.y-=player.speed;
 if(keys.s)player.y+=player.speed;
 if(keys.a)player.x-=player.speed;
 if(keys.d)player.x+=player.speed;

 enemies.forEach(e=>{
  if(Math.hypot(player.x-e.x,player.y-e.y)<24){
   player.hp=Math.max(0,player.hp-e.atk*0.05);
  }
 });
}

/* ===== 攻擊 ===== */
function attack(dmg){
 enemies.forEach(e=>{
  if(Math.hypot(player.x-e.x,player.y-e.y)<60){
   e.hp-=dmg;
   if(e.hp<=0){
    gold+=10;
    enemies=enemies.filter(x=>x!==e);
   }
  }
 });
}

/* ===== 技能 ===== */
function cast(i){
 const s=skills[i];
 if(!s||player.mp<s.mp)return;
 player.mp-=s.mp;
 attack(s.dmg);
}

/* ===== 繪製 ===== */
function render(){
 ctx.fillStyle="#3a7";
 ctx.fillRect(0,0,960,540);

 /* 建築 */
 buildings.forEach(b=>{
  ctx.fillStyle="#654";
  ctx.fillRect(b.x,b.y,b.w,b.h);
  ctx.fillStyle="#000";
  ctx.fillRect(b.x+b.w/2-10,b.y+b.h-20,20,20); // 門
  ctx.fillStyle="#fff";
  ctx.fillText(b.name,b.x+10,b.y+15);
 });

 /* 玩家 */
 ctx.fillStyle="#f2c9ac";
 ctx.fillRect(player.x+6,player.y,8,8);
 ctx.fillStyle="#36c";
 ctx.fillRect(player.x+4,player.y+8,12,10);

 /* 怪物 */
 enemies.forEach(e=>{
  ctx.fillStyle="#6a4";
  ctx.fillRect(e.x,e.y,22,22);
  ctx.fillStyle="#f33";
  ctx.fillRect(e.x,e.y-6,22*(e.hp/e.maxHp),4);
  ctx.fillStyle="#fff";
  ctx.fillText(`${e.name} Lv${e.lv}`,e.x-10,e.y-10);
 });

 hp.innerText=Math.round(player.hp);
 mp.innerText=Math.round(player.mp);
 atk.innerText=player.atk;
 gold.innerText=gold;
}

/* ===== 互動 ===== */
function interact(){
 buildings.forEach(b=>{
  if(Math.hypot(player.x-(b.x+b.w/2),player.y-(b.y+b.h))<40){
   alert(b.name+"（內部系統下一步會做）");
  }
 });
}

/* ===== 控制 ===== */
window.addEventListener("keydown",e=>{
 keys[e.key.toLowerCase()]=true;
 if(e.key===" ")attack(player.atk);
 if(e.key>="1"&&e.key<="3")cast(Number(e.key));
 if(e.key.toLowerCase()==="e")interact();
});
window.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

/* ===== 主迴圈 ===== */
(function loop(){
 update();render();
 requestAnimationFrame(loop);
})();
</script>
</body>
</html>

