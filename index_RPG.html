<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>異世界 RPG</title>
<style>
  body { background: #111; display: flex; justify-content: center; }
  canvas { background: #000; image-rendering: pixelated; margin-top: 20px; }
  #battleUI {
    position: absolute;
    top: 50px; left: 50%;
    transform: translateX(-50%);
    width: 300px;
    padding: 15px;
    background: #222;
    color: white;
    border: 2px solid white;
    display: none;
  }
  button { margin-top: 10px; width: 100%; padding: 10px; }
</style>
</head>
<body>

<canvas id="game" width="640" height="640"></canvas>

<!-- 戰鬥介面 -->
<div id="battleUI">
  <h3 id="monsterName"></h3>
  <p id="monsterHP"></p>
  <button id="attackBtn">攻擊</button>
</div>

<script>
//========================
// 基本設定
//========================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let tileSize = 32;
let mapSize = 20;

// 角色資料
let player = { x: 5, y: 5, hp: 100, atk: 10 };

// 怪物列表
const monsters = [
  { name: "史萊姆", hp: 30, atk: 5, color: "#00c0ff" },
  { name: "哥布林", hp: 50, atk: 8, color: "#00ff00" },
  { name: "半獸人", hp: 80, atk: 12, color: "#ff6600" }
];

let currentMonster = null;

//========================
// 建立地圖
//========================
let map = [];
for (let y = 0; y < mapSize; y++) {
  map[y] = [];
  for (let x = 0; x < mapSize; x++) {
    map[y][x] = Math.random() < 0.15 ? 1 : 0; // 1 = 樹
  }
}

//========================
// 繪製地圖 & 玩家
//========================
function drawMap() {
  for (let y = 0; y < mapSize; y++) {
    for (let x = 0; x < mapSize; x++) {
      ctx.fillStyle = map[y][x] === 0 ? "#2e8b57" : "#145214";
      ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
    }
  }
}

function drawPlayer() {
  ctx.fillStyle = "yellow";
  ctx.fillRect(player.x * tileSize, player.y * tileSize, tileSize, tileSize);
}

//========================
// 主畫面 loop
//========================
function draw() {
  ctx.clearRect(0, 0, 640, 640);
  drawMap();
  drawPlayer();
  requestAnimationFrame(draw);
}
draw();

//========================
// 遇怪 + 戰鬥
//========================
function startBattle() {
  currentMonster = JSON.parse(JSON.stringify(
    monsters[Math.floor(Math.random() * monsters.length)]
  ));

  document.getElementById("monsterName").textContent = "你遇到了：" + currentMonster.name;
  document.getElementById("monsterHP").textContent = "HP：" + currentMonster.hp;
  document.getElementById("battleUI").style.display = "block";
}

document.getElementById("attackBtn").onclick = () => {
  // 攻擊怪物
  currentMonster.hp -= player.atk;
  if (currentMonster.hp <= 0) {
    alert("你打敗了 " + currentMonster.name + "！");
    document.getElementById("battleUI").style.display = "none";
    return;
  }

  // 怪物反擊
  player.hp -= currentMonster.atk;
  if (player.hp <= 0) {
    alert("你被打敗了！遊戲結束");
    location.reload();
  }

  document.getElementById("monsterHP").textContent = "HP：" + currentMonster.hp;
};

//========================
// 控制角色走動
//========================
document.addEventListener("keydown", (e) => {
  if (document.getElementById("battleUI").style.display === "block") return;

  if (e.key === "ArrowUp") player.y--;
  if (e.key === "ArrowDown") player.y++;
  if (e.key === "ArrowLeft") player.x--;
  if (e.key === "ArrowRight") player.x++;

  player.x = Math.max(0, Math.min(mapSize - 1, player.x));
  player.y = Math.max(0, Math.min(mapSize - 1, player.y));

  // 10% 遇怪機率
  if (Math.random() < 0.10) startBattle();
});
</script>

</body>
</html>


